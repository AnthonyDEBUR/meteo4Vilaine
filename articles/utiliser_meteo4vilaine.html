<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Utiliser le package meteo4Vilaine • meteo4Vilaine</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Utiliser le package meteo4Vilaine">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">meteo4Vilaine</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/utiliser_meteo4vilaine.html">Utiliser le package meteo4Vilaine</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/AnthonyDEBUR/meteo4Vilaine/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Utiliser le package meteo4Vilaine</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/AnthonyDEBUR/meteo4Vilaine/blob/master/vignettes/utiliser_meteo4vilaine.Rmd" class="external-link"><code>vignettes/utiliser_meteo4vilaine.Rmd</code></a></small>
      <div class="hidden name"><code>utiliser_meteo4vilaine.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/AnthonyDEBUR/meteo4Vilaine" class="external-link">meteo4Vilaine</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="présentation">Présentation<a class="anchor" aria-label="anchor" href="#pr%C3%A9sentation"></a>
</h2>
<p>Le package <strong><code>meteo4Vilaine</code></strong> permet :</p>
<ul>
<li>de créer des fonctions SQL dans une base PostgreSQL/PostGIS,</li>
<li>d’interroger les précipitations entre deux dates,</li>
<li>d’interpoler les données par krigeage,</li>
<li>d’extraire des valeurs proches à partir d’objets
<code>sf</code>.</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="connexion-à-la-base-de-données">1. Connexion à la base de données<a class="anchor" aria-label="anchor" href="#connexion-%C3%A0-la-base-de-donn%C3%A9es"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpostgres.r-dbi.org" class="external-link">RPostgres</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/vubiostat/r-yaml/" class="external-link">yaml</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu">yaml</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/yaml/man/read_yaml.html" class="external-link">read_yaml</a></span><span class="op">(</span><span class="st">"C://workspace//gwilenalim//yaml//config.yml"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span></span>
<span>  <span class="fu">Postgres</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  host <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">host</span>,</span>
<span>  port <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">port</span>,</span>
<span>  user <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">user</span>,</span>
<span>  password <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">password</span>,</span>
<span>  dbname <span class="op">=</span> <span class="va">config</span><span class="op">$</span><span class="va">dbname</span></span>
<span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="création-de-la-fonction-sql-qui-permet-de-calculer-des-sommes-de-précipitations-entre-2-dates">2. Création de la fonction SQL qui permet de calculer des sommes de
précipitations entre 2 dates<a class="anchor" aria-label="anchor" href="#cr%C3%A9ation-de-la-fonction-sql-qui-permet-de-calculer-des-sommes-de-pr%C3%A9cipitations-entre-2-dates"></a>
</h2>
<p>Cette fonction est à exécuter une fois après création de la base de
données</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_sql_requete_calcule_somme.html">create_sql_requete_calcule_somme</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="extraction-des-précipitations-entre-deux-dates">3. Extraction des précipitations entre deux dates<a class="anchor" aria-label="anchor" href="#extraction-des-pr%C3%A9cipitations-entre-deux-dates"></a>
</h2>
<p>Cette fonction permet d’extraire les données de précipitations en
base entre deux dates. Elle renvoie un objet sf avec le positionnement
des stations et la somme des précipitations (en mm) entre les deux
dates.</p>
<p>Seules les stations dont le nombre de jours avec des données
disponibles / le nombre de jour entre les deux dates commandées est
supérieur ou égale au paramètre complétude sont renvoyées.</p>
<p>Par exemple si on interroge pour récupérer 100 jours de données et
qu’on passe l’indicateur taux_completude à 0.5, seules les stations avec
au moins 50 jours de données sur la période sont renvoyées.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pluvio_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pluviometrie_entre_2_dates.html">pluviometrie_entre_2_dates</a></span><span class="op">(</span></span>
<span>  date_debut <span class="op">=</span> <span class="st">"2020-01-01"</span>,</span>
<span>  date_fin <span class="op">=</span> <span class="st">"2020-01-10"</span>,</span>
<span>  con <span class="op">=</span> <span class="va">con</span>,</span>
<span>  taux_completude <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pluvio_sf</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="extraction-de-valeurs-proches">4. Extraction de valeurs proches<a class="anchor" aria-label="anchor" href="#extraction-de-valeurs-proches"></a>
</h2>
<p>On injecte un objet sf de type points (points_sf). En retour la
fonction recherche, pour chaque élément de points_sf quel est le point
de la couche ref_sf le plus proche. Il renvoie alors la valeur contenue
dans la colonne “col_valeur” de ref_sf</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pluvio_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pluviometrie_entre_2_dates.html">pluviometrie_entre_2_dates</a></span><span class="op">(</span></span>
<span>  date_debut <span class="op">=</span> <span class="st">"2020-01-05"</span>,</span>
<span>  date_fin <span class="op">=</span> <span class="st">"2020-01-05"</span>,</span>
<span>  con <span class="op">=</span> <span class="va">con</span>,</span>
<span>  taux_completude <span class="op">=</span> <span class="fl">0.8</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/valeurs_proches_sf.html">valeurs_proches_sf</a></span><span class="op">(</span></span>
<span>  points_sf <span class="op">=</span> <span class="va">rennes_l93</span>,</span>
<span>  ref_sf <span class="op">=</span> <span class="va">pluvio_sf</span>,</span>
<span>  col_valeur <span class="op">=</span> <span class="st">"somme_precipitations"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="interpolation-spatiale-par-krigeage">5. Interpolation spatiale par krigeage<a class="anchor" aria-label="anchor" href="#interpolation-spatiale-par-krigeage"></a>
</h2>
<p>Cette fonction permet, pour une date donnée, d’interpoler
spatialement les résultats en utilisant l’ensemble des données
disponibles à la même date.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">rennes_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>lon <span class="op">=</span> <span class="op">-</span><span class="fl">1.6794</span>, lat <span class="op">=</span> <span class="fl">48.1147</span><span class="op">)</span></span>
<span><span class="va">rennes_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">rennes_coords</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">rennes_l93</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">rennes_sf</span>, crs <span class="op">=</span> <span class="fl">2154</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/krige_pluie_journaliere.html">krige_pluie_journaliere</a></span><span class="op">(</span><span class="va">rennes_l93</span>, date <span class="op">=</span> <span class="st">"2020-01-05"</span>, con <span class="op">=</span> <span class="va">con</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Le package <code>meteo4Vilaine</code> fournit une interface puissante
pour interroger, analyser et interpoler des données météorologiques
spatialisées.</p>
<hr>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Anthony DE BURGHRAVE.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
